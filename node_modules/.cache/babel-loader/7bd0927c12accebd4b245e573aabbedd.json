{"ast":null,"code":"import _toConsumableArray from\"C:/Users/pradh/Desktop/devrev/TheBookCrafter.com/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"C:/Users/pradh/Desktop/devrev/TheBookCrafter.com/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/pradh/Desktop/devrev/TheBookCrafter.com/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\pradh\\\\Desktop\\\\devrev\\\\TheBookCrafter.com\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState,useEffect}from'react';import jwt_decode from\"jwt-decode\";import{useLocation}from\"react-router-dom\";import\"./Shop.css\";import{Sidebar,ProductCard,useWishlist,useCart,useSearchBar,Pagination}from\"../../index.js\";import{useProductAvailable}from\"../../Context/product-context\";import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Shop(props){var _useProductAvailable=useProductAvailable(),productsAvailableList=_useProductAvailable.productsAvailableList,dispatchSortedProductsList=_useProductAvailable.dispatchSortedProductsList,productFilterOptions=_useProductAvailable.productFilterOptions;var _useWishlist=useWishlist(),dispatchUserWishlist=_useWishlist.dispatchUserWishlist;var _useCart=useCart(),dispatchUserCart=_useCart.dispatchUserCart;var _useLocation=useLocation(),pathname=_useLocation.pathname;var _useSearchBar=useSearchBar(),searchBarTerm=_useSearchBar.searchBarTerm;var _useState=useState(1),_useState2=_slicedToArray(_useState,2),currentPage=_useState2[0],setCurrentPage=_useState2[1];var _useState3=useState(12),_useState4=_slicedToArray(_useState3,2),productsPerPage=_useState4[0],setProductsPerPage=_useState4[1];useEffect(function(){window.scrollTo(0,0);},[pathname,currentPage]);useEffect(function(){if(JSON.stringify(productsAvailableList)===JSON.stringify([])&&JSON.stringify(productFilterOptions)===JSON.stringify({includeOutOfStock:true,onlyFastDeliveryProducts:false,minPrice:0,maxPrice:1200,fiction:true,thriller:true,tech:true,philosophy:true,romance:true,manga:true,minRating:1})){//Refresh happened - Filters are default yet productsAvailableList is empty\n//Redo api call to get data\ntry{_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var productsAvailableData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('https://bookztron-server.vercel.app/api/home/products');case 2:productsAvailableData=_context.sent;dispatchSortedProductsList({type:\"ADD_ITEMS_TO_PRODUCTS_AVAILABLE_LIST\",payload:_toConsumableArray(productsAvailableData.data.productsList)});case 4:case\"end\":return _context.stop();}}},_callee);}))();}catch(error){console.log(\"Error : \",error);}}},[]);useEffect(function(){var token=localStorage.getItem('token');if(token){var user=jwt_decode(token);if(!user){localStorage.removeItem('token');}else{(function(){var _getUpdatedWishlistAndCart=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var updatedUserInfo;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.get(\"https://bookztron-server.vercel.app/api/user\",{headers:{'x-access-token':localStorage.getItem('token')}});case 2:updatedUserInfo=_context2.sent;if(updatedUserInfo.data.status===\"ok\"){dispatchUserWishlist({type:\"UPDATE_USER_WISHLIST\",payload:updatedUserInfo.data.user.wishlist});dispatchUserCart({type:\"UPDATE_USER_CART\",payload:updatedUserInfo.data.user.cart});}case 4:case\"end\":return _context2.stop();}}},_callee2);}));function getUpdatedWishlistAndCart(){return _getUpdatedWishlistAndCart.apply(this,arguments);}return getUpdatedWishlistAndCart;})()();}}},[]);var searchedProducts=productsAvailableList.filter(function(productdetails){return productdetails.bookName.toLowerCase().includes(searchBarTerm.toLowerCase())||productdetails.author.toLowerCase().includes(searchBarTerm.toLowerCase());});var indexOfLastProduct=currentPage*productsPerPage;var indexOfFirstProduct=indexOfLastProduct-productsPerPage;var currentSearchedProducts=searchedProducts.slice(indexOfFirstProduct,indexOfLastProduct);var currentProductsAvailableList=productsAvailableList.slice(indexOfFirstProduct,indexOfLastProduct);return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"shop-container\",children:[/*#__PURE__*/_jsx(Sidebar,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"products-container\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Showing \",searchBarTerm===\"\"?productsAvailableList.length:searchedProducts.length,\" products\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"products-card-grid\",children:productsAvailableList&&(searchBarTerm===\"\"?currentProductsAvailableList.map(function(productdetails){return/*#__PURE__*/_jsx(ProductCard,{productdetails:productdetails},productdetails._id);}):currentSearchedProducts.map(function(productdetails){return/*#__PURE__*/_jsx(ProductCard,{productdetails:productdetails},productdetails._id);}))}),/*#__PURE__*/_jsx(Pagination,{productsPerPage:productsPerPage,totalProducts:searchBarTerm===\"\"?productsAvailableList.length:searchedProducts.length,paginate:setCurrentPage})]})]})});}export{Shop};","map":{"version":3,"sources":["C:/Users/pradh/Desktop/devrev/TheBookCrafter.com/src/Pages/Shop/Shop.jsx"],"names":["React","useState","useEffect","jwt_decode","useLocation","Sidebar","ProductCard","useWishlist","useCart","useSearchBar","Pagination","useProductAvailable","axios","Shop","props","productsAvailableList","dispatchSortedProductsList","productFilterOptions","dispatchUserWishlist","dispatchUserCart","pathname","searchBarTerm","currentPage","setCurrentPage","productsPerPage","setProductsPerPage","window","scrollTo","JSON","stringify","includeOutOfStock","onlyFastDeliveryProducts","minPrice","maxPrice","fiction","thriller","tech","philosophy","romance","manga","minRating","get","productsAvailableData","type","payload","data","productsList","error","console","log","token","localStorage","getItem","user","removeItem","headers","updatedUserInfo","status","wishlist","cart","getUpdatedWishlistAndCart","searchedProducts","filter","productdetails","bookName","toLowerCase","includes","author","indexOfLastProduct","indexOfFirstProduct","currentSearchedProducts","slice","currentProductsAvailableList","length","map","_id"],"mappings":"6iBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,MAAOC,CAAAA,UAAP,KAAuB,YAAvB,CACA,OAASC,WAAT,KAA4B,kBAA5B,CACA,MAAO,YAAP,CACA,OACEC,OADF,CAEEC,WAFF,CAGEC,WAHF,CAIEC,OAJF,CAKEC,YALF,CAMEC,UANF,KAOO,gBAPP,CAQA,OAASC,mBAAT,KAAoC,+BAApC,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,C,wFAEA,QAASC,CAAAA,IAAT,CAAcC,KAAd,CAAqB,CAEjB,yBAIIH,mBAAmB,EAJvB,CACEI,qBADF,sBACEA,qBADF,CAEEC,0BAFF,sBAEEA,0BAFF,CAGEC,oBAHF,sBAGEA,oBAHF,CAMA,iBAAiCV,WAAW,EAA5C,CAAQW,oBAAR,cAAQA,oBAAR,CACA,aAA6BV,OAAO,EAApC,CAAQW,gBAAR,UAAQA,gBAAR,CACA,iBAAqBf,WAAW,EAAhC,CAAQgB,QAAR,cAAQA,QAAR,CACA,kBAA0BX,YAAY,EAAtC,CAAQY,aAAR,eAAQA,aAAR,CACA,cAAwCpB,QAAQ,CAAC,CAAD,CAAhD,wCAAQqB,WAAR,eAAqBC,cAArB,eACA,eAAgDtB,QAAQ,CAAC,EAAD,CAAxD,yCAAQuB,eAAR,eAAyBC,kBAAzB,eAEAvB,SAAS,CAAC,UAAM,CACdwB,MAAM,CAACC,QAAP,CAAgB,CAAhB,CAAmB,CAAnB,EACD,CAFQ,CAEN,CAACP,QAAD,CAAWE,WAAX,CAFM,CAAT,CAIApB,SAAS,CAAC,UAAI,CAEZ,GAAK0B,IAAI,CAACC,SAAL,CAAed,qBAAf,IAAwCa,IAAI,CAACC,SAAL,CAAe,EAAf,CAAzC,EAEID,IAAI,CAACC,SAAL,CAAeZ,oBAAf,IAAuCW,IAAI,CAACC,SAAL,CAAe,CACtDC,iBAAiB,CAAU,IAD2B,CAEtDC,wBAAwB,CAAG,KAF2B,CAGtDC,QAAQ,CAAmB,CAH2B,CAItDC,QAAQ,CAAmB,IAJ2B,CAKtDC,OAAO,CAAoB,IAL2B,CAMtDC,QAAQ,CAAmB,IAN2B,CAOtDC,IAAI,CAAuB,IAP2B,CAQtDC,UAAU,CAAiB,IAR2B,CAStDC,OAAO,CAAoB,IAT2B,CAUtDC,KAAK,CAAsB,IAV2B,CAWtDC,SAAS,CAAkB,CAX2B,CAAf,CAF/C,CAgBA,CACE;AACA;AACA,GAAI,CACF,wDAAC,mLACqC5B,CAAAA,KAAK,CAAC6B,GAAN,CAAU,uDAAV,CADrC,QACOC,qBADP,eAEC1B,0BAA0B,CAAC,CAAC2B,IAAI,CAAC,sCAAN,CAA8CC,OAAO,oBAAMF,qBAAqB,CAACG,IAAtB,CAA2BC,YAAjC,CAArD,CAAD,CAA1B,CAFD,sDAAD,KAID,CACD,MAAMC,KAAN,CAAa,CACXC,OAAO,CAACC,GAAR,CAAY,UAAZ,CAAwBF,KAAxB,EACD,CACF,CACF,CA/BQ,CA+BP,EA/BO,CAAT,CAiCA7C,SAAS,CAAC,UAAI,CACZ,GAAMgD,CAAAA,KAAK,CAACC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAZ,CAEA,GAAGF,KAAH,CACA,CACE,GAAMG,CAAAA,IAAI,CAAGlD,UAAU,CAAC+C,KAAD,CAAvB,CACA,GAAG,CAACG,IAAJ,CACA,CACIF,YAAY,CAACG,UAAb,CAAwB,OAAxB,EACH,CAHD,IAKA,CACE,mGAAC,mLAE6B1C,CAAAA,KAAK,CAAC6B,GAAN,CAC5B,8CAD4B,CAE5B,CACEc,OAAO,CACP,CACE,iBAAkBJ,YAAY,CAACC,OAAb,CAAqB,OAArB,CADpB,CAFF,CAF4B,CAF7B,QAEKI,eAFL,gBAWC,GAAGA,eAAe,CAACX,IAAhB,CAAqBY,MAArB,GAA8B,IAAjC,CACA,CACEvC,oBAAoB,CAAC,CAACyB,IAAI,CAAE,sBAAP,CAA8BC,OAAO,CAAEY,eAAe,CAACX,IAAhB,CAAqBQ,IAArB,CAA0BK,QAAjE,CAAD,CAApB,CACAvC,gBAAgB,CAAC,CAACwB,IAAI,CAAE,kBAAP,CAA0BC,OAAO,CAAEY,eAAe,CAACX,IAAhB,CAAqBQ,IAArB,CAA0BM,IAA7D,CAAD,CAAhB,CACD,CAfF,wDAAD,WAAgBC,CAAAA,yBAAhB,kEAAgBA,CAAAA,yBAAhB,QAiBD,CACF,CACF,CA/BQ,CA+BP,EA/BO,CAAT,CAiCA,GAAIC,CAAAA,gBAAgB,CAAG9C,qBAAqB,CAC3C+C,MADsB,CACf,SAAAC,cAAc,CAAE,CACtB,MACEA,CAAAA,cAAc,CAACC,QAAf,CAAwBC,WAAxB,GAAsCC,QAAtC,CAA+C7C,aAAa,CAAC4C,WAAd,EAA/C,GACGF,cAAc,CAACI,MAAf,CAAsBF,WAAtB,GAAoCC,QAApC,CAA6C7C,aAAa,CAAC4C,WAAd,EAA7C,CAFL,CAID,CANsB,CAAvB,CAQA,GAAMG,CAAAA,kBAAkB,CAAG9C,WAAW,CAAGE,eAAzC,CACA,GAAM6C,CAAAA,mBAAmB,CAAED,kBAAkB,CAAG5C,eAAhD,CACA,GAAI8C,CAAAA,uBAAuB,CAAGT,gBAAgB,CAACU,KAAjB,CAAuBF,mBAAvB,CAA4CD,kBAA5C,CAA9B,CACA,GAAII,CAAAA,4BAA4B,CAAGzD,qBAAqB,CAACwD,KAAtB,CAA4BF,mBAA5B,CAAiDD,kBAAjD,CAAnC,CAEA,mBACI,kCACI,aAAK,SAAS,CAAC,gBAAf,wBACI,KAAC,OAAD,IADJ,cAEI,aAAK,SAAS,CAAC,oBAAf,wBACI,iCAAa/C,aAAa,GAAK,EAAlB,CAAqBN,qBAAqB,CAAC0D,MAA3C,CAAkDZ,gBAAgB,CAACY,MAAhF,eADJ,cAEI,YAAK,SAAS,CAAC,oBAAf,UAEQ1D,qBAAqB,GAEnBM,aAAa,GAAK,EAAlB,CAEEmD,4BAA4B,CAACE,GAA7B,CAAiC,SAAAX,cAAc,qBAC7C,KAAC,WAAD,EAAsC,cAAc,CAAEA,cAAtD,EAAkBA,cAAc,CAACY,GAAjC,CAD6C,EAA/C,CAFF,CAMEL,uBAAuB,CAACI,GAAxB,CAA4B,SAAAX,cAAc,qBACxC,KAAC,WAAD,EAAsC,cAAc,CAAEA,cAAtD,EAAkBA,cAAc,CAACY,GAAjC,CADwC,EAA1C,CARiB,CAF7B,EAFJ,cAmBI,KAAC,UAAD,EACE,eAAe,CAAEnD,eADnB,CAEE,aAAa,CAAEH,aAAa,GAAK,EAAlB,CAAqBN,qBAAqB,CAAC0D,MAA3C,CAAkDZ,gBAAgB,CAACY,MAFpF,CAGE,QAAQ,CAAElD,cAHZ,EAnBJ,GAFJ,GADJ,EADJ,CAgCH,CAED,OAASV,IAAT","sourcesContent":["import React, { useState, useEffect } from 'react'\r\nimport jwt_decode from \"jwt-decode\"\r\nimport { useLocation } from \"react-router-dom\"\r\nimport \"./Shop.css\"\r\nimport { \r\n  Sidebar, \r\n  ProductCard,\r\n  useWishlist,\r\n  useCart,\r\n  useSearchBar,\r\n  Pagination\r\n} from \"../../index.js\"\r\nimport { useProductAvailable } from \"../../Context/product-context\"\r\nimport axios from 'axios'\r\n\r\nfunction Shop(props) {\r\n\r\n    let { \r\n      productsAvailableList, \r\n      dispatchSortedProductsList, \r\n      productFilterOptions \r\n    } = useProductAvailable()\r\n\r\n    const { dispatchUserWishlist } = useWishlist()\r\n    const { dispatchUserCart } = useCart()\r\n    const { pathname } = useLocation();\r\n    const { searchBarTerm } = useSearchBar()\r\n    const [ currentPage, setCurrentPage ] = useState(1)\r\n    const [ productsPerPage, setProductsPerPage ] = useState(12)\r\n  \r\n    useEffect(() => {\r\n      window.scrollTo(0, 0);\r\n    }, [pathname, currentPage]);\r\n\r\n    useEffect(()=>{\r\n      \r\n      if( (JSON.stringify(productsAvailableList)===JSON.stringify([]))\r\n          && (\r\n              JSON.stringify(productFilterOptions)===JSON.stringify({\r\n              includeOutOfStock        : true,\r\n              onlyFastDeliveryProducts : false,\r\n              minPrice                 : 0,\r\n              maxPrice                 : 1200,\r\n              fiction                  : true,\r\n              thriller                 : true,\r\n              tech                     : true,\r\n              philosophy               : true,\r\n              romance                  : true,\r\n              manga                    : true,\r\n              minRating                : 1}) \r\n             )\r\n        )\r\n      {\r\n        //Refresh happened - Filters are default yet productsAvailableList is empty\r\n        //Redo api call to get data\r\n        try {\r\n          (async () => {\r\n            const productsAvailableData = await axios.get('https://bookztron-server.vercel.app/api/home/products')\r\n            dispatchSortedProductsList({type:\"ADD_ITEMS_TO_PRODUCTS_AVAILABLE_LIST\", payload: [...productsAvailableData.data.productsList] })\r\n          }) ()\r\n        }\r\n        catch(error) {\r\n          console.log(\"Error : \", error);\r\n        }\r\n      }\r\n    },[])\r\n\r\n    useEffect(()=>{\r\n      const token=localStorage.getItem('token')\r\n\r\n      if(token)\r\n      {\r\n        const user = jwt_decode(token)\r\n        if(!user)\r\n        {\r\n            localStorage.removeItem('token')\r\n        }\r\n        else\r\n        {\r\n          (async function getUpdatedWishlistAndCart()\r\n          {\r\n            let updatedUserInfo = await axios.get(\r\n            \"https://bookztron-server.vercel.app/api/user\",\r\n            {\r\n              headers:\r\n              {\r\n                'x-access-token': localStorage.getItem('token'),\r\n              }\r\n            })\r\n\r\n            if(updatedUserInfo.data.status===\"ok\")\r\n            {\r\n              dispatchUserWishlist({type: \"UPDATE_USER_WISHLIST\",payload: updatedUserInfo.data.user.wishlist})\r\n              dispatchUserCart({type: \"UPDATE_USER_CART\",payload: updatedUserInfo.data.user.cart})\r\n            }\r\n          })()\r\n        }\r\n      }   \r\n    },[])\r\n\r\n    let searchedProducts = productsAvailableList\r\n    .filter(productdetails=>{\r\n      return (\r\n        productdetails.bookName.toLowerCase().includes(searchBarTerm.toLowerCase()) \r\n        || productdetails.author.toLowerCase().includes(searchBarTerm.toLowerCase())\r\n      )\r\n    })\r\n\r\n    const indexOfLastProduct = currentPage * productsPerPage;\r\n    const indexOfFirstProduct= indexOfLastProduct - productsPerPage;\r\n    let currentSearchedProducts = searchedProducts.slice(indexOfFirstProduct, indexOfLastProduct)\r\n    let currentProductsAvailableList = productsAvailableList.slice(indexOfFirstProduct, indexOfLastProduct)\r\n\r\n    return (\r\n        <div>\r\n            <div className='shop-container'>\r\n                <Sidebar/>\r\n                <div className='products-container'>\r\n                    <h2>Showing {searchBarTerm === \"\"?productsAvailableList.length:searchedProducts.length} products</h2>\r\n                    <div className=\"products-card-grid\">\r\n                        {\r\n                            productsAvailableList && \r\n                            (\r\n                              searchBarTerm === \"\" ?\r\n                              (\r\n                                currentProductsAvailableList.map(productdetails => (\r\n                                  <ProductCard key={productdetails._id} productdetails={productdetails} />\r\n                                ))\r\n                              ) : (\r\n                                currentSearchedProducts.map(productdetails => (\r\n                                  <ProductCard key={productdetails._id} productdetails={productdetails} />\r\n                                ))\r\n                              )\r\n                            )\r\n                        }\r\n                    </div>\r\n                    <Pagination \r\n                      productsPerPage={productsPerPage} \r\n                      totalProducts={searchBarTerm === \"\"?productsAvailableList.length:searchedProducts.length}\r\n                      paginate={setCurrentPage}\r\n                    />\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport { Shop }"]},"metadata":{},"sourceType":"module"}