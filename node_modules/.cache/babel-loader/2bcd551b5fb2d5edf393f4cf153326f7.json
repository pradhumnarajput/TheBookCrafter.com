{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\pradh\\\\Desktop\\\\devrev\\\\Bookztron-E-Commerce_Book_Store\\\\src\\\\Components\\\\ShoppingBill\\\\ShoppingBill.jsx\",\n    _s = $RefreshSig$();\n\nimport \"./ShoppingBill.css\";\nimport { useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useCart, useToast, useOrders } from \"../../index\";\nimport axios from \"axios\";\nimport { loadRazorpayScript } from \"../../UtilityFunctions/loadRazorpayScript\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction ShoppingBill() {\n  _s();\n\n  const navigate = useNavigate();\n  const {\n    userCart,\n    dispatchUserCart\n  } = useCart();\n  const {\n    showToast\n  } = useToast();\n  const {\n    dispatchUserOrders\n  } = useOrders();\n  let totalDiscount = 0,\n      totalBill = 0,\n      finalBill = 0;\n  const [couponName, setCouponName] = useState(\"\");\n  userCart.forEach(product => {\n    let discountOnCurrentProduct = (product.originalPrice - product.discountedPrice) * product.quantity;\n    totalDiscount = totalDiscount + discountOnCurrentProduct;\n    totalBill = totalBill + product.discountedPrice * product.quantity;\n  });\n\n  if (couponName === \"BOOKS200\") {\n    finalBill = totalBill - 200;\n  } else {\n    finalBill = totalBill;\n  }\n\n  async function displayRazorPay() {\n    const res = await loadRazorpayScript(\"https://checkout.razorpay.com/v1/checkout.js\");\n\n    if (!res) {\n      showToast(\"error\", \"\", \"Razorpay SDK failed to load, kindly check internet connection!\");\n      return;\n    }\n\n    let finalBillAmount = (finalBill * 100).toString();\n    const dataResponse = await axios.post(\"https://bookztron-server.vercel.app/api/razorpay\", {\n      finalBillAmount\n    });\n    let data = dataResponse.data;\n    var options = {\n      \"key\": \"rzp_test_hyc3ht0ngvqOD5\",\n      \"amount\": data.amount,\n      \"currency\": data.currency,\n      \"name\": \"Bookztron\",\n      \"description\": \"Thank you for shopping!\",\n      \"image\": \"https://raw.githubusercontent.com/Naman-Saxena1/Bookztron-E-Commerce_Book_Store/development/public/favicon-icon.png\",\n      \"order_id\": data.id,\n      \"handler\": async function (response) {\n        showToast(\"success\", \"\", \"Payment Successful! ðŸ˜Ž\");\n        showToast(\"success\", \"\", \"Order added to your bag!\");\n        let newOrderItemsArray = userCart.map(orderItem => {\n          return { ...orderItem,\n            orderId: data.id\n          };\n        });\n        let ordersUpdatedResponse = await axios.post(\"https://bookztron-server.vercel.app/api/orders\", {\n          newOrderItemsArray\n        }, {\n          headers: {\n            'x-access-token': localStorage.getItem('token')\n          }\n        });\n        let emptyCartResponse = await axios.patch(\"https://bookztron-server.vercel.app/api/cart/empty/all\", {}, {\n          headers: {\n            'x-access-token': localStorage.getItem('token')\n          }\n        });\n\n        if (emptyCartResponse.data.status === 'ok') {\n          dispatchUserCart({\n            type: \"UPDATE_USER_CART\",\n            payload: []\n          });\n        }\n\n        if (ordersUpdatedResponse.data.status === 'ok') {\n          dispatchUserOrders({\n            type: \"UPDATE_USER_ORDERS\",\n            payload: ordersUpdatedResponse.data.user.orders\n          });\n          navigate('/orders');\n        }\n      }\n    };\n    var paymentObject = new window.Razorpay(options);\n    paymentObject.open();\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"cart-bill\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"bill-heading\",\n      children: \"Bill Details\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 13\n    }, this), userCart.map(product => {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"cart-price-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"cart-item-bookname\",\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            children: product.bookName\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 109,\n            columnNumber: 33\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"cart-item-quantity\",\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"X \", product.quantity]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 112,\n            columnNumber: 33\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"cart-item-total-price\",\n          id: \"price-sum\",\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"\\u20B9\", product.discountedPrice * product.quantity]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 33\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 29\n        }, this)]\n      }, product._id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 25\n      }, this);\n    }), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"cart-discount-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"cart-item-total-discount\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Discount\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"cart-item-total-discount-amount\",\n        id: \"price-sum\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"\\u20B9 \", totalDiscount]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"cart-delivery-charges-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"cart-item-total-delivery-charges\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Delivery Charges\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"cart-item-total-delivery-charges-amount\",\n        id: \"price-sum\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          id: \"delivery-charges\",\n          children: \"\\u20B9 50\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"cart-total-charges-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"cart-item-total-delivery-charges\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: /*#__PURE__*/_jsxDEV(\"b\", {\n            children: \"Total Charges\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 146,\n            columnNumber: 24\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"cart-item-total-delivery-charges-amount\",\n        id: \"price-sum\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          id: \"total-charges\",\n          children: /*#__PURE__*/_jsxDEV(\"b\", {\n            children: [\"\\u20B9 \", finalBill]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 149,\n            columnNumber: 43\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"apply-coupon-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Apply Coupon\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        value: couponName,\n        onChange: event => setCouponName(event.target.value),\n        placeholder: \"Try BOOKS200\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"place-order-btn solid-secondary-btn\",\n      onClick: displayRazorPay,\n      children: \"Place Order\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 99,\n    columnNumber: 9\n  }, this);\n}\n\n_s(ShoppingBill, \"01SOizh9GIcTrGlx31LZ6IrzQnM=\", false, function () {\n  return [useNavigate, useCart, useToast, useOrders];\n});\n\n_c = ShoppingBill;\nexport { ShoppingBill };\n\nvar _c;\n\n$RefreshReg$(_c, \"ShoppingBill\");","map":{"version":3,"sources":["C:/Users/pradh/Desktop/devrev/Bookztron-E-Commerce_Book_Store/src/Components/ShoppingBill/ShoppingBill.jsx"],"names":["useState","useNavigate","useCart","useToast","useOrders","axios","loadRazorpayScript","ShoppingBill","navigate","userCart","dispatchUserCart","showToast","dispatchUserOrders","totalDiscount","totalBill","finalBill","couponName","setCouponName","forEach","product","discountOnCurrentProduct","originalPrice","discountedPrice","quantity","displayRazorPay","res","finalBillAmount","toString","dataResponse","post","data","options","amount","currency","id","response","newOrderItemsArray","map","orderItem","orderId","ordersUpdatedResponse","headers","localStorage","getItem","emptyCartResponse","patch","status","type","payload","user","orders","paymentObject","window","Razorpay","open","bookName","_id","event","target","value"],"mappings":"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","sourcesContent":["import \"./ShoppingBill.css\"\r\nimport { useState } from \"react\"\r\nimport { useNavigate } from \"react-router-dom\"\r\nimport { useCart, useToast, useOrders } from \"../../index\"\r\nimport axios from \"axios\"\r\nimport { loadRazorpayScript } from \"../../UtilityFunctions/loadRazorpayScript\"\r\n\r\nfunction ShoppingBill()\r\n{\r\n    const navigate = useNavigate()\r\n    const { userCart, dispatchUserCart } = useCart()\r\n    const { showToast } = useToast()\r\n    const { dispatchUserOrders }= useOrders()\r\n    let totalDiscount = 0, totalBill = 0, finalBill = 0;\r\n    const [ couponName, setCouponName ] = useState(\"\")\r\n\r\n    userCart.forEach(product=>{\r\n        let discountOnCurrentProduct = ( (product.originalPrice - product.discountedPrice) * product.quantity )\r\n        totalDiscount = totalDiscount + discountOnCurrentProduct\r\n        totalBill = totalBill + ( product.discountedPrice * product.quantity )\r\n    })\r\n\r\n    if(couponName===\"BOOKS200\")\r\n    {\r\n        finalBill = totalBill - 200;\r\n    }\r\n    else\r\n    {\r\n        finalBill = totalBill;\r\n    }\r\n\r\n    async function displayRazorPay()\r\n    {\r\n        const res = await loadRazorpayScript(\"https://checkout.razorpay.com/v1/checkout.js\")\r\n\r\n        if(!res)\r\n        {\r\n            showToast(\"error\",\"\",\"Razorpay SDK failed to load, kindly check internet connection!\")\r\n            return;\r\n        }\r\n\r\n        let finalBillAmount = (finalBill*100).toString()\r\n\r\n        const dataResponse = await axios.post(\r\n            \"https://bookztron-server.vercel.app/api/razorpay\",\r\n            {\r\n                finalBillAmount\r\n            }\r\n        )\r\n\r\n        let data = dataResponse.data\r\n\r\n        var options = {\r\n            \"key\": \"rzp_test_hyc3ht0ngvqOD5\", \r\n            \"amount\": data.amount, \r\n            \"currency\": data.currency,\r\n            \"name\": \"Bookztron\",\r\n            \"description\": \"Thank you for shopping!\",\r\n            \"image\": \"https://raw.githubusercontent.com/Naman-Saxena1/Bookztron-E-Commerce_Book_Store/development/public/favicon-icon.png\",\r\n            \"order_id\": data.id,\r\n            \"handler\": async function (response){\r\n                showToast(\"success\",\"\",\"Payment Successful! ðŸ˜Ž\")\r\n                showToast(\"success\",\"\",\"Order added to your bag!\")\r\n                let newOrderItemsArray = userCart.map(orderItem=>{\r\n                    return {...orderItem, orderId: data.id}\r\n                })\r\n                let ordersUpdatedResponse = await axios.post(\r\n                    \"https://bookztron-server.vercel.app/api/orders\",\r\n                    {\r\n                        newOrderItemsArray\r\n                    },\r\n                    {\r\n                        headers : {'x-access-token': localStorage.getItem('token')}\r\n                    }\r\n                )\r\n                let emptyCartResponse = await axios.patch(\r\n                    \"https://bookztron-server.vercel.app/api/cart/empty/all\",\r\n                    {},\r\n                    {\r\n                        headers : {'x-access-token': localStorage.getItem('token')}\r\n                    }\r\n                )\r\n                if(emptyCartResponse.data.status==='ok')\r\n                {\r\n                    dispatchUserCart({type: \"UPDATE_USER_CART\",payload: []})\r\n                }\r\n                if(ordersUpdatedResponse.data.status==='ok')\r\n                {\r\n                    dispatchUserOrders({type: \"UPDATE_USER_ORDERS\",payload: ordersUpdatedResponse.data.user.orders})\r\n                    navigate('/orders')\r\n                }\r\n            }\r\n        };\r\n        var paymentObject = new window.Razorpay(options);\r\n        paymentObject.open();\r\n    }\r\n\r\n    return (\r\n        <div className=\"cart-bill\">\r\n            <h2 className=\"bill-heading\">Bill Details</h2>\r\n\r\n            <hr></hr>\r\n            {\r\n                userCart.map(product=>{\r\n\r\n                    return (\r\n                        <div key={product._id} className=\"cart-price-container\">\r\n                            <div className=\"cart-item-bookname\">\r\n                                <p>{product.bookName}</p>\r\n                            </div>\r\n                            <div className=\"cart-item-quantity\">\r\n                                <p>X {product.quantity}</p>\r\n                            </div>\r\n                            <div className=\"cart-item-total-price\" id=\"price-sum\">\r\n                                <p>&#8377;{product.discountedPrice * product.quantity}</p>\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                })\r\n            }\r\n            \r\n            <hr></hr>\r\n\r\n            <div className=\"cart-discount-container\">\r\n                <div className=\"cart-item-total-discount\">\r\n                    <p>Discount</p>\r\n                </div>\r\n                <div className=\"cart-item-total-discount-amount\" id=\"price-sum\">\r\n                    <p>&#8377; {totalDiscount}</p>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"cart-delivery-charges-container\">\r\n                <div className=\"cart-item-total-delivery-charges\">\r\n                    <p>Delivery Charges</p>\r\n                </div>\r\n                <div className=\"cart-item-total-delivery-charges-amount\" id=\"price-sum\">\r\n                    <p id=\"delivery-charges\">&#8377; 50</p>\r\n                </div>\r\n            </div>\r\n\r\n            <hr></hr>\r\n\r\n            <div className=\"cart-total-charges-container\">\r\n                <div className=\"cart-item-total-delivery-charges\">\r\n                    <p><b>Total Charges</b></p>\r\n                </div>\r\n                <div className=\"cart-item-total-delivery-charges-amount\" id=\"price-sum\">\r\n                    <p id=\"total-charges\"><b>&#8377; {finalBill}</b></p>\r\n                </div>\r\n            </div>\r\n\r\n            <hr></hr>\r\n\r\n            <div className=\"apply-coupon-container\">\r\n                <p>Apply Coupon</p>\r\n                <input\r\n                    value={couponName}\r\n                    onChange={(event)=>setCouponName(event.target.value)}\r\n                    placeholder=\"Try BOOKS200\"\r\n                ></input>\r\n            </div>\r\n\r\n            <button \r\n                className=\"place-order-btn solid-secondary-btn\"\r\n                onClick={displayRazorPay}\r\n            >\r\n                Place Order\r\n            </button>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport { ShoppingBill }"]},"metadata":{},"sourceType":"module"}